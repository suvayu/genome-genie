<%!
    from genomegenie.batch.filters import sample_name, path_transform
%>

$GATKHOME/gatk \
% if javaopts is UNDEFINED:
    --java-options '-Xmx64g' \
% else:
    --java-options ${javaopts} \
% endif
% if tumor_bam is UNDEFINED:
    HaplotypeCaller \
    -I ${normal_bam} \
% else:
    Mutect2 \
    -I ${tumor_bam} -tumor ${sample_name(tumor_bam)} \
    -I ${normal_bam} -normal ${sample_name(normal_bam)} \
    --germline-resource ${db} \
    --panel-of-normals ${pon} \
% endif
    -R ${ref_fasta} \
    -O ${path_transform(normal_bam, output, 'vcf.gz')} \
    -bamout ${path_transform(normal_bam, output)} \
% if exome_bed is not UNDEFINED:
    -L ${exome_bed} \
% endif
% if nprocs is not UNDEFINED:
    --native-pair-hmm-threads ${f'{nprocs}'}
% endif
